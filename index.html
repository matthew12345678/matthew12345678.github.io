


<!DOCTYPE html>



<html lang="en">



<head>



<meta charset="utf-8">



<title>RNBO Sample Loader + GUI</title>



<meta name="viewport" content="width=device-width, initial-scale=1">



<meta name="theme-color" content="#000000">



<meta name="rnbo-version" content="1.0.0-alpha.5">



<style>



body {



font-family: sans-serif;



background: #121212;



color: yellow;



padding: 2em;



}







input[type="file"] {



margin-bottom: 2rem;



}







#log {



background: #333;



color: #eee;



padding: 1em;



margin-top: 2em;



font-size: 0.9em;



}







.waveform-container {



display: flex;



align-items: center;



}







.waveform-block {



display: flex;



flex-direction: column;



align-items: flex-start;



}







.visual-wrapper {



display: flex;



flex-direction: row;



align-items: center;



margin-bottom: 10px;



}







.side-sliders {



display: flex;



flex-direction: column;



align-items: center;



margin-right: 10px;



height: 120px;



}







.pan-slider,



.volume-slider {



display: flex;



flex-direction: column;



align-items: center;



margin-bottom: 10px;



}







.volume-slider input[type="range"] {



writing-mode: bt-lr;



-webkit-appearance: slider-vertical;



width: 20px;



height: 100%;



}







#waveform {



display: block;



background: #fff;



border: 1px solid #ccc;



width: 600px;



height: 120px;



}







.range-slider {



position: relative;



width: 600px;



height: 40px;



}







/* Disable interaction on base input so only the thumb is clickable */



.range-slider input[type="range"] {



position: absolute;



width: 100%;



height: 40px;



background: none;



-webkit-appearance: none;



pointer-events: none;



}







/* Enable pointer events only on the thumb for each slider */



.range-slider input#min {



z-index: 2;



}







.range-slider input#max {



z-index: 3;



}







/* Make the thumbs large and fully clickable */



.range-slider input[type="range"]::-webkit-slider-thumb {



-webkit-appearance: none;



pointer-events: all;



height: 24px;



width: 24px;



background: #ccc;



border-radius: 50%;



cursor: pointer;



margin-top: -10px;



position: relative;



z-index: 4;



}







.range-fill {



position: absolute;



height: 4px;



background: #888;



top: 50%;



transform: translateY(-50%);



z-index: 0;



}







#dragZone {



margin-left: 110px;



margin-top: 0.5rem;



}







.control-column {



display: flex;



flex-direction: column;



justify-content: flex-start;



margin-left: 20px;



gap: 10px;



}







.control-row {



display: flex;



align-items: center;



gap: 12px;



flex-wrap: wrap;



}







.rate-block {



display: flex;



flex-direction: column;



align-items: flex-start;



gap: 6px;



}







.rate-group {



display: flex;



align-items: center;



gap: 6px;



font-size: 14px;



}







.toggle {



display: flex;



align-items: center;



gap: 6px;



}







button.momentary {



font-size: 11px;



padding: 3px 6px;



min-width: 80px;



}



</style>











</head>



<body>







<h1>RNBO Sample Loader + GUI</h1>







<input type="file" id="fileInput" accept="audio/*">



<div id="log">üìù Log Output:</div>







<div class="waveform-container">



<div class="waveform-block">







<!-- Waveform + sliders in a shared column -->



<div style="display: flex; flex-direction: column;">



<!-- Position slider aligned with waveform -->



<div style="margin: 0 0 25px 135px; width: 600px;">



<label for="positionSlider" style="font-size: 12px;">Position</label><br>



<input type="range" id="positionSlider" min="0" max="1" step="0.001" value="0" style="width: 100%;">



</div>







<div class="visual-wrapper">



<div class="side-sliders">



<div class="pan-slider">



<input type="range" id="panSlider" min="0" max="1" step="0.01" value="0">



<label for="panSlider">Pan</label>



</div>



<div class="volume-slider">



<input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.8">



<label for="volumeSlider">Volume</label>



</div>



</div>



<canvas id="waveform" width="600" height="120"></canvas>



</div>







<div style="margin-left: 130px;">



<div class="range-slider">



<input type="range" id="min" min="0" max="100" value="0" step="1">



<input type="range" id="max" min="0" max="100" value="180" step="1">



<div id="range-fill" class="range-fill"></div>



</div>



</div>



<button id="dragZone">‚Üê Drag Range ‚Üí</button>



</div>



</div>







<!-- Controls -->



<div class="control-column">



<div class="control-row">



<label class="toggle">



<input type="checkbox" id="toggleStart">



<span>Start</span>



</label>



<label class="toggle">



<input type="checkbox" id="toggleBackwards">



<span>Backwards</span>



</label>



<label class="toggle">



<input type="checkbox" id="toggleLoop">



<span>Loop</span>



</label>



</div>



<div class="rate-block">



<div class="rate-group">



<label for="rateSlider">Rate:</label>



<input type="range" id="rateSlider" min="-5" max="5" step="0.1" value="0">



<span id="rateValue">0</span>



</div>



<button class="momentary" id="selectAllBtn">Select All</button>



<button class="momentary" id="panicBtn">Panic</button>



</div>



</div>



</div>







<script src="https://cdn.cycling74.com/rnbo/1.3.3/rnbo.min.js"></script>

<script>

const log = msg => {
    console.log(msg);
    document.getElementById("log").innerHTML += `<br>${msg}`;
};

let device;
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
window.audioContext = audioContext;

async function setupRNBO() {
    try {
        log("üß† Fetching patch...");
        const res = await fetch("export/patch.export.json");
        if (!res.ok) throw new Error("‚ö†Ô∏è Failed to load patch.export.json");

        const patcher = await res.json();
        device = await RNBO.createDevice({ patcher, context: audioContext });
        device.node.connect(audioContext.destination);
        window.device = device;

        log("‚úÖ RNBO device is ready.");
    } catch (err) {
        log("‚ùå RNBO setup error: " + err.message);
    }
}

function setRNBOParam(id, value) {
    const param = device?.parametersById.get(id);
    if (param) param.value = value;
}

// üî• NEW - Reset everything neatly
function resetAllControls() {
    setRNBOParam("panic", 1);
    setTimeout(() => setRNBOParam("panic", 0), 100);

    document.getElementById("volumeSlider").value = 0.8;
    document.getElementById("panSlider").value = 0.5;
    document.getElementById("rateSlider").value = 1.0;
    document.getElementById("rateValue").textContent = "1.0";
    document.getElementById("toggleLoop").checked = true;
    document.getElementById("toggleBackwards").checked = false;
    document.getElementById("toggleStart").checked = true;

    setRNBOParam("volume", 0.8);
    setRNBOParam("pan", 0.5);
    setRNBOParam("rate", 1.0);
    setRNBOParam("loop", 1.0);
    setRNBOParam("backwards", 0);
    setRNBOParam("play", 1.0);

    const minSlider = document.getElementById("min");
    const maxSlider = document.getElementById("max");
    const rangeFill = document.getElementById("range-fill");

    minSlider.value = 0;
    maxSlider.value = 100;
    rangeFill.style.left = "0%";
    rangeFill.style.width = "100%";

    setRNBOParam("posl", 0);
    setRNBOParam("posr", 1);
}

document.getElementById("volumeSlider").addEventListener("input", e => {
    setRNBOParam("volume", parseFloat(e.target.value));
});

document.getElementById("panSlider").addEventListener("input", e => {
    setRNBOParam("pan", parseFloat(e.target.value));
});

document.getElementById("rateSlider").addEventListener("input", e => {
    const val = parseFloat(e.target.value);
    document.getElementById("rateValue").textContent = val.toFixed(1);
    setRNBOParam("rate", val);
});

document.getElementById("toggleLoop").addEventListener("change", e => {
    setRNBOParam("loop", e.target.checked ? 1 : 0);
});

document.getElementById("toggleBackwards").addEventListener("change", e => {
    setRNBOParam("backwards", e.target.checked ? 1 : 0);
});

document.getElementById("toggleStart").addEventListener("change", e => {
    setRNBOParam("play", e.target.checked ? 1 : 0);
});

// Panic button - now just calls resetAllControls!
document.getElementById("panicBtn").addEventListener("click", () => {
    resetAllControls();
});

// Select All button (you can keep your existing logic for this one)
document.getElementById("selectAllBtn").addEventListener("click", () => {
    setRNBOParam("selectall", 1);
    setTimeout(() => setRNBOParam("selectall", 0), 100);

    const minSlider = document.getElementById("min");
    const maxSlider = document.getElementById("max");
    const rangeFill = document.getElementById("range-fill");

    minSlider.value = 0;
    maxSlider.value = 100;
    rangeFill.style.left = "0%";
    rangeFill.style.width = "100%";

    setRNBOParam("posl", 0);
    setRNBOParam("posr", 1);
});

// ------- Sliders and Dragging logic (same as before) -------
const minSlider = document.getElementById('min');
const maxSlider = document.getElementById('max');
const rangeFill = document.getElementById('range-fill');
const dragZone = document.getElementById('dragZone');

function updateRange() {
    let min = parseInt(minSlider.value);
    let max = parseInt(maxSlider.value);
    if (min > max) [min, max] = [max, min];

    minSlider.value = min;
    maxSlider.value = max;
    rangeFill.style.left = min + '%';
    rangeFill.style.width = (max - min) + '%';

    setRNBOParam("posl", min / 100);
    setRNBOParam("posr", max / 100);
}

minSlider.addEventListener('input', updateRange);
maxSlider.addEventListener('input', updateRange);

let isDragging = false;
let startX, startMin, startMax;

dragZone.addEventListener('mousedown', e => {
    isDragging = true;
    startX = e.clientX;
    startMin = parseInt(minSlider.value);
    startMax = parseInt(maxSlider.value);
    document.body.style.cursor = 'ew-resize';
});

window.addEventListener('mouseup', () => {
    isDragging = false;
    document.body.style.cursor = '';
});

window.addEventListener('mousemove', e => {
    if (!isDragging) return;
    const dx = e.clientX - startX;
    const delta = Math.round(dx / 3);
    const range = startMax - startMin;
    let newMin = Math.max(0, Math.min(100 - range, startMin + delta));
    let newMax = newMin + range;

    minSlider.value = newMin;
    maxSlider.value = newMax;
    updateRange();
});

updateRange();

// üî• After loading an audio file, reset everything automatically
document.getElementById('fileInput').addEventListener('change', async (evt) => {
    const file = evt.target.files[0];
    if (!file) return log("‚ö†Ô∏è No file selected");

    const reader = new FileReader();
    reader.onload = async () => {
        try {
            await audioContext.resume();
            log("üéµ Decoding audio...");
            const buffer = await audioContext.decodeAudioData(reader.result);
            log("‚úÖ Audio decoded");

            device.setDataBuffer("kick", buffer, buffer.numberOfChannels, buffer.sampleRate);
            drawWaveform(buffer);

            // üëâ Automatically reset all controls after loading
            resetAllControls();
        } catch (err) {
            log("‚ùå Audio decode/load error: " + err.message);
        }
    };
    reader.readAsArrayBuffer(file);
});

// Waveform drawing (same as before)
function drawWaveform(buffer) {
    const canvas = document.getElementById("waveform");
    const ctx = canvas.getContext("2d");
    const width = canvas.width;
    const height = canvas.height;
    const data = buffer.getChannelData(0);
    const step = Math.ceil(data.length / width);
    const amp = height / 2;

    ctx.clearRect(0, 0, width, height);
    ctx.beginPath();
    for (let i = 0; i < width; i++) {
        const slice = data.slice(i * step, (i + 1) * step);
        const min = Math.min(...slice);
        const max = Math.max(...slice);
        ctx.moveTo(i, (1 + min) * amp);
        ctx.lineTo(i, (1 + max) * amp);
    }
    ctx.strokeStyle = "#0077aa";
    ctx.stroke();
}

setupRNBO();

</script>


</body>

<a href="otherpage.html" style="position: fixed; bottom: 10px; width: 100%; text-align: center;">Go to Other Page</a>


</html>






